<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    .box { background:#fff; padding:20px; border-radius:8px; width:300px; margin-bottom:20px; }
    input, select { width:100%; padding:8px; margin:6px 0; }
    button { padding:10px; width:100%; margin-top:10px; cursor:pointer; }
    h2 { margin-bottom:10px; }
  </style>
</head>

<body>

<div class="box" id="loginBox">
  <h2>Admin Login</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="box" id="editor" style="display:none;">
  <h2>Edit Team</h2>

  <select id="teamSelect" onchange="loadTeam()">
    <option value="">Select Team</option>
  </select>

  <input id="mp" type="number" placeholder="Matches Played">
  <input id="l" type="number" placeholder="Losses">
  <input id="w" type="number" placeholder="Wins">
  <input id="d" type="number" placeholder="Draws">
  <input id="pts" type="number" placeholder="Points">
  <input id="gd" type="number" placeholder="Goal Difference">
  <input id="stars" type="number" step="0.5" placeholder="Stars">
  <input id="rank" type="number" placeholder="Rank">

  <button onclick="saveTeam()">Save Changes</button>
  <button style="background:#e74c3c; color:#fff;" onclick="deleteTeam()">Delete Team</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="firebase.js"></script>

<script>
  // DOM Elements
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const loginBox = document.getElementById("loginBox");
  const editorBox = document.getElementById("editor");

  const teamSelect = document.getElementById("teamSelect");
  const mp = document.getElementById("mp");
  const l = document.getElementById("l");
  const w = document.getElementById("w");
  const d = document.getElementById("d");
  const pts = document.getElementById("pts");
  const gd = document.getElementById("gd");
  const stars = document.getElementById("stars");
  const rank = document.getElementById("rank");

  let currentID = null;

  // LOGIN
  function login() {
    auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
      .then(() => {
        alert("Logged In");
        loginBox.style.display = "none";
        editorBox.style.display = "block";
        loadTeams();
      })
      .catch(e => alert("Login failed: " + e.message));
  }

  // LOAD TEAMS
  function loadTeams() {
    db.collection("standings").get()
      .then(snapshot => {
        teamSelect.innerHTML = `<option value="">Select Team</option>`;
        snapshot.forEach(doc => {
          const data = doc.data();
          teamSelect.innerHTML += `<option value="${doc.id}">${data.name}</option>`;
        });
        clearForm();
      })
      .catch(e => alert("Error loading teams: " + e.message));
  }

  // LOAD SELECTED TEAM
  function loadTeam() {
    const id = teamSelect.value;
    if (!id) {
      clearForm();
      return;
    }

    currentID = id;

    db.collection("standings").doc(id).get()
      .then(doc => {
        if (!doc.exists) return alert("Team not found!");
        const t = doc.data();
        mp.value = t.mp ?? 0;
        l.value = t.l ?? 0;
        w.value = t.w ?? 0;
        d.value = t.d ?? 0;
        pts.value = t.pts ?? 0;
        gd.value = t.gd ?? 0;
        stars.value = t.stars ?? 0;
        rank.value = t.rank ?? 0;
      })
      .catch(e => alert("Error loading team: " + e.message));
  }

  // SAVE TEAM
  function saveTeam() {
    if (!currentID) return alert("Please select a team first.");

    const data = {
      name: currentID,
      mp: Number(mp.value),
      l: Number(l.value),
      w: Number(w.value),
      d: Number(d.value),
      pts: Number(pts.value),
      gd: Number(gd.value),
      stars: Number(stars.value),
      rank: Number(rank.value)
    };

    db.collection("standings").doc(currentID).set(data, { merge: true })
      .then(() => alert("Team Updated!"))
      .catch(e => alert("Error saving team: " + e.message));
  }

  // DELETE TEAM
  function deleteTeam() {
    if (!currentID) return alert("Please select a team first.");
    if (!confirm("Delete this team?")) return;

    db.collection("standings").doc(currentID).delete()
      .then(() => {
        alert("Team Deleted");
        loadTeams();
      })
      .catch(e => alert("Error deleting team: " + e.message));
  }

  // CLEAR FORM
  function clearForm() {
    currentID = null;
    mp.value = l.value = w.value = d.value = pts.value = gd.value = stars.value = rank.value = '';
  }
</script>

</body>
</html>

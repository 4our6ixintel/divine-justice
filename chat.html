<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate.dls Chat Room</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; }
  header { background: #2c3e50; color: white; text-align: center; padding: 20px; position: relative; }
  nav a { color: white; margin: 0 10px; text-decoration: none; font-weight: bold; }
  .container { width: 90%; max-width: 700px; margin: 20px auto; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }

  #chat-box { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #fafafa; border-radius: 5px; }
  .chat-message { margin-bottom: 10px; padding: 8px; border-radius: 5px; background: #ecf0f1; }
  .chat-message strong { color: #2c3e50; }
  .timestamp { font-size: 0.8em; color: #7f8c8d; margin-left: 5px; }

  #chat-form { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
  #username, #message { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
  #send-btn { padding: 10px 15px; border: none; background: #2c3e50; color: white; border-radius: 5px; cursor: pointer; }
  #send-btn:hover { background: #34495e; }

  #logoutBtn { position: absolute; right: 20px; top: 20px; background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
  #logoutBtn:hover { background: #c0392b; }

  /* Login Modal */
  #loginModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 10; }
  .modal-content { background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; text-align: center; }
  input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
  button { cursor: pointer; }

  @media (max-width: 600px) {
    header h1 { font-size: 1.4em; }
    nav a { display: block; margin: 5px 0; }
    #chat-form { flex-direction: column; }
  }
</style>
</head>
<body>

<header>
  <h1>Ultimate.dls Chat Room</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="blog.html">Blog</a>
    <a href="match.html">Matches</a>
    <a href="tables.html">Tables</a>
  </nav>
  <button id="logoutBtn" style="display:none;">Logout</button>
</header>

<!-- Optional future link space -->
<div style="text-align:center;margin-top:10px;">
  <a href="#" id="groupLink" target="_blank" style="color:#2c3e50;text-decoration:underline;">Join our community (coming soon)</a>
</div>

<div class="container">
  <div id="chat-box"></div>
  <form id="chat-form">
    <input type="text" id="username" placeholder="Your Name" required>
    <input type="text" id="message" placeholder="Type a message" required>
    <button type="submit" id="send-btn">Send</button>
  </form>
</div>

<!-- Login Modal -->
<div id="loginModal">
  <div class="modal-content">
    <h2>Login to Ultimate.dls</h2>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <button id="loginBtn">Login</button>
    <button id="signupBtn">Sign Up</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // Your Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBdK_tiTsYhX27IsdjBnBRJ1a-4Eanoe8g",
    authDomain: "ultimatedlschat.firebaseapp.com",
    databaseURL: "https://ultimatedlschat-default-rtdb.firebaseio.com",
    projectId: "ultimatedlschat",
    storageBucket: "ultimatedlschat.firebasestorage.app",
    messagingSenderId: "485655960703",
    appId: "1:485655960703:web:b6a97068cf5ebf1e98734a",
    measurementId: "G-SDE2YCCMZW"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const chatBox = document.getElementById('chat-box');
  const chatForm = document.getElementById('chat-form');
  const usernameInput = document.getElementById('username');
  const messageInput = document.getElementById('message');
  const loginModal = document.getElementById('loginModal');
  const logoutBtn = document.getElementById('logoutBtn');

  // Auth State Check
  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginModal.style.display = "none";
      logoutBtn.style.display = "block";
      console.log("User logged in:", user.email);
    } else {
      loginModal.style.display = "flex";
      logoutBtn.style.display = "none";
    }
  });

  logoutBtn.onclick = () => signOut(auth);

  // Login
  document.getElementById("loginBtn").onclick = async () => {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert("Login successful!");
    } catch (err) {
      alert("Login error: " + err.message);
      console.error(err);
    }
  };

  // Signup
  document.getElementById("signupBtn").onclick = async () => {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      alert("Account created! You can now log in.");
    } catch (err) {
      alert("Signup error: " + err.message);
      console.error(err);
    }
  };

  // Chat functionality
  const messagesRef = ref(db, "messages");

  chatForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const username = usernameInput.value.trim();
    const text = messageInput.value.trim();
    if (!username || !text) return;

    const timestamp = new Date();
    const timeStr = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true });

    push(messagesRef, { username, text, time: timeStr });
    messageInput.value = "";
  });

  onChildAdded(messagesRef, (snapshot) => {
    const msg = snapshot.val();
    const div = document.createElement("div");
    div.classList.add("chat-message");
    div.innerHTML = `<strong>${msg.username}:</strong> ${msg.text} <span class="timestamp">${msg.time}</span>`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>
</body>
</html>
